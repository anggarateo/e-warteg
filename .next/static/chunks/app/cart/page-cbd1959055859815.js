(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[565],{462:function(e,a,n){Promise.resolve().then(n.bind(n,5705))},1706:function(e,a,n){"use strict";n.d(a,{Z:function(){return d}});var t=n(7437),s=n(9411),r=n(544),l=n(594),i=n(1895),c=n(1718),o=n(9571),u=n(5925);function d(e){let{isOpen:a,onClose:n,payment:d}=e;async function m(e){let a=[];if(await (0,s.U2)("trx").then(e=>a=JSON.parse((null==e?void 0:e.value)||"[]")).catch(e=>{console.log("e get update trx:",e),u.default.error(e)}),a.length){let n=a.map(a=>(a.id===e.id&&(a.status=e.status),a));n?await (0,s.Ue)("trx",JSON.stringify(n)).catch(e=>{console.log("e create trx api:",e),u.default.error(e)}):u.default.error("Id transaksi tidak sesuai")}else u.default.error("Transaksi tidak ditemukan")}async function h(){(null==d?void 0:d.id)&&await (0,r.d)(d.id).then(async e=>await m(e)).catch(e=>{console.log("e onclose",e),u.default.error(e)}),n()}return(0,t.jsx)(l.R,{isOpen:a,isDismissable:!1,isKeyboardDismissDisabled:!0,scrollBehavior:"inside",size:"5xl",placement:"center",classNames:{wrapper:"sm:mt-8"},onClose:h,children:(0,t.jsx)(i.A,{children:()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.k,{children:"Pembayaran"}),(0,t.jsx)(o.I,{children:(0,t.jsx)("iframe",{src:null==d?void 0:d.invoice_url,className:"h-[calc(100vh*(9/10))]"})})]})})})}},5705:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return O}});var t=n(7437),s=n(9411),r=n(544),l=n(2759),i=n(504),c=n(795),o=n(5310),u=n(2398),d=n(6691),m=n.n(d),h=n(4033),f=n(2265),p=n(5925),x=n(594),g=n(1895),b=n(1718),v=n(9571),j=n(1213),y=n(7836),w=n(2913);function N(e){let{onClose:a,isOpen:n}=e,[r,l]=(0,f.useState)({name:"",table:"",phone:""}),[i,c]=(0,f.useState)("dine-in"),[d,m]=(0,f.useState)(!1);async function h(){if("dine-in"===i&&Object.values(r).filter(e=>e).length<3||!r.name&&!r.phone)return p.default.error("Isi pemesan dengan benar"),!1;m(!0),await (0,s.Ue)("customer",JSON.stringify(r)).then(()=>{a(!0)}).catch(e=>{console.log("e modal customer:",e),p.default.error(e)}),m(!1)}async function N(){m(!0),await (0,s.U2)("customer").then(e=>{if(null==e?void 0:e.value){let a=JSON.parse(e.value);a.table||c("takeaway"),l(a)}}).catch(e=>{console.log("e get customer:",e),p.default.error(e)}),m(!1)}return(0,f.useEffect)(()=>{N()},[]),(0,t.jsx)(x.R,{isOpen:n,scrollBehavior:"inside",placement:"center",classNames:{wrapper:"sm:mt-8"},onClose:()=>a(!1),children:(0,t.jsx)(g.A,{children:()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.k,{children:"Pemesan"}),(0,t.jsxs)(v.I,{children:[(0,t.jsx)(u.Y,{label:"Nama Pemesan",value:r.name,isInvalid:!r.name,errorMessage:r.name?"":"*Wajib diisi",onValueChange:e=>l({...r,name:e})}),(0,t.jsxs)(j.X,{orientation:"horizontal",value:i,onValueChange:e=>c(e),children:[(0,t.jsx)(y.J,{value:"dine-in",children:"Makan di tempat"}),(0,t.jsx)(y.J,{value:"takeaway",children:"Dibungkus"})]}),"dine-in"===i&&(0,t.jsx)(u.Y,{label:"Nomor Meja",type:"number",inputMode:"tel",value:r.table,isInvalid:!r.table,errorMessage:r.table?"":"*Wajib diisi",onValueChange:e=>l({...r,table:e})}),(0,t.jsx)(u.Y,{label:"Nomor Handphone",placeholder:"081234567890",type:"number",inputMode:"tel",value:r.phone,isInvalid:!r.phone,errorMessage:r.phone?"":"*Wajib diisi",onValueChange:e=>l({...r,phone:e})})]}),(0,t.jsx)(w.R,{children:(0,t.jsx)(o.A,{disabled:d,onClick:h,children:"Bayar"})})]})})})}var k=n(1706);function O(){let e;let[a,n]=(0,f.useState)([]),[d,x]=(0,f.useState)(!0),[g,b]=(0,f.useState)(),v=(0,h.useRouter)(),[j,y]=(0,f.useState)(!1),[w,O]=(0,f.useState)(!1);function S(e,t){n(a.map(a=>{if((null==a?void 0:a.id)===t.id){let n=parseInt(a.qty?a.qty:"1");e?n++:n--,n<1&&(n=1),a.qty=n.toString()}return a}))}async function C(){x(!0),await (0,s.U2)("order").then(e=>{n(JSON.parse((null==e?void 0:e.value)||"[]"))}).catch(e=>{console.log("e get order mycart:",e),p.default.error(e)}),x(!1)}async function _(){x(!0),await (0,s.U2)("customer").then(a=>{if(null==a?void 0:a.value){let n=JSON.parse(a.value);e={given_names:n.name,surname:n.table,mobile_number:"+62"+n.phone.substring(1)}}}).catch(e=>{console.log("e get customer:",e),p.default.error(e)}),x(!1)}async function J(){if(!a.length)return(0,p.default)("Kamu belum pesan apapun, segera lakukan transaksi!");let n=a.map(e=>({name:e.name,quantity:parseInt(e.qty),price:5e3,category:"Food"})),t=n.map(e=>5e3*e.quantity).reduce((e,a)=>e+a);if(x(!0),!e)return p.default.error("Pemesan tidak ditemukan"),y(!0);await (0,r.Z)({items:n,amount:t,customer:e}).then(async e=>{var a;if(null==e?void 0:null===(a=e.errors)||void 0===a?void 0:a.length)return e.errors.map(e=>p.default.error(e.messages[0]));b(e),await U(e),O(!0)}).catch(e=>{console.log("e checkout:",e),p.default.error(e)}),x(!1)}async function U(e){let a,n=[];await (0,s.U2)("trx").then(e=>{n=JSON.parse((null==e?void 0:e.value)||"[]")}).catch(e=>{console.log("e get trx mycart:",e),p.default.error(e)});let t={id:e.id,external_id:e.external_id,status:e.status,amount:e.amount,invoice_url:e.invoice_url,created:e.created,items:e.items,customer:e.customer};a=n.length?[...n,t]:[t],await (0,s.Ue)("trx",JSON.stringify(a)).catch(e=>console.log("e create trx:",e))}async function I(){x(!0),await (0,s.Od)("order"),v.push("/transaction"),x(!1),O(!1)}async function P(e){await _(),e?J():y(!0)}return(0,f.useEffect)(()=>{C()},[]),(0,t.jsxs)(t.Fragment,{children:[w&&(0,t.jsx)(k.Z,{isOpen:w,payment:g,onClose:I}),j&&(0,t.jsx)(N,{isOpen:j,onClose:e=>{y(!1),e&&P(e)}}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 sm:gap-4 p-2 sm:p-4 justify-center sm:justify-start pb-28",children:[d&&(0,t.jsx)(c.X,{className:"rounded-xl shadow-md w-full md:w-[31%] lg:w-[32%] h-60"}),!d&&!a.length&&(0,t.jsx)("h1",{className:"p-4 text-center",children:"Kamu belum pesan apapun, segera lakukan pemesanan!"}),!d&&a.length>0&&(0,t.jsx)("div",{className:"fixed z-50 bottom-12 sm:bottom-5 sm:right-5 flex justify-center w-screen sm:w-max p-2 bg-white shadow-inner sm:bg-none sm:shadow-none",children:(0,t.jsx)(o.A,{className:"shadow-lg w-full",onClick:()=>P(!1),children:"Lanjutkan Pembayaran"})}),!d&&a.map(e=>(0,t.jsxs)("div",{className:"rounded-xl shadow-md border w-full md:w-[31%] lg:w-[32%] divide-y-2",children:[(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(m(),{src:"https://placehold.co/100x100?text=Nasi Pecel",alt:"Nasi Pecel",width:100,height:100,className:"rounded-tl-xl"}),(0,t.jsxs)("div",{className:"p-2 space-y-1",children:[(0,t.jsxs)("h1",{className:"font-semibold",children:["Nasi Pecel ",e.id]}),(0,t.jsx)("h1",{className:"text-xs",children:"Catatan: -"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center p-2",children:[(0,t.jsx)(o.A,{color:"danger",onClick:()=>(function(e){let t=a.filter(a=>(null==a?void 0:a.id)!==e);n(t),(0,s.Ue)("order",JSON.stringify(t)).then(()=>{(0,p.default)("i ".concat(e," deleted"))}).catch(e=>{console.log("e ondelete mycart:",e),p.default.error(e)})})(e.id),children:"Hapus"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(o.A,{className:"text-lg min-w-unit-8",onClick:()=>S(!1,e),children:(0,t.jsx)(i.G,{icon:l.Kl4})}),(0,t.jsx)(u.Y,{value:e.qty,classNames:{inputWrapper:"h-10",input:"text-center"},className:"w-12",type:"number",onValueChange:t=>{let s;s=t?1>parseInt(t)?"1":t:"1",n(a.map(a=>((null==a?void 0:a.id)===e.id&&(a.qty=s),a)))}}),(0,t.jsx)(o.A,{className:"text-lg min-w-unit-8",onClick:()=>S(!0,e),children:(0,t.jsx)(i.G,{icon:l.r8p})})]})]})]},e.id))]})]})}},9411:function(e,a,n){"use strict";n.d(a,{Od:function(){return s},U2:function(){return l},Ue:function(){return r}}),n(5355);var t=n(1162),s=(0,t.$)("8d3be4cbdf9359c37a6faa66016ae23ce3c89877"),r=(0,t.$)("99c7277d511d8c5a4628e9beb52adb8b4fe1db44"),l=(0,t.$)("a1a67a894942ea186c21e91d038c0f409ccaffc7")},544:function(e,a,n){"use strict";n.d(a,{Z:function(){return s},d:function(){return r}}),n(5355);var t=n(1162),s=(0,t.$)("cb443d0626162d2d5132bb5b4127b8cf66570048"),r=(0,t.$)("992d62b349c079a0e1c4ebe66a1a776c1ea6d078")}},function(e){e.O(0,[676,854,714,284,868,478,745,517,971,938,744],function(){return e(e.s=462)}),_N_E=e.O()}]);